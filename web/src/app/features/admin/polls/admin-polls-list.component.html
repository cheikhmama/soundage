<div class="max-w-5xl mx-auto space-y-4">
  <!-- Header: centered -->
  <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
    <div class="text-center sm:text-left">
      <h1 class="text-2xl font-semibold text-slate-900">Manage polls</h1>
      <p class="text-slate-500 text-sm mt-1">Create and edit polls. Users can vote on active polls.</p>
    </div>
    <div class="flex justify-center sm:justify-end">
      <a
        routerLink="/admin/polls/new"
        class="inline-flex items-center justify-center px-4 py-2.5 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
      >
        Create poll
      </a>
    </div>
  </div>

  <!-- Filters: on small screens open in modal; on md+ show 2x2 grid -->
  <div class="flex justify-center">
    <!-- Small screens: button to open filters modal -->
    <div class="md:hidden w-full flex justify-center">
      <button
        type="button"
        (click)="openFiltersModal()"
        class="inline-flex items-center justify-center gap-2 text-slate-700 bg-white border border-slate-300 hover:bg-slate-50 focus:ring-4 focus:ring-slate-200 font-medium rounded-lg text-sm px-4 py-2.5 focus:outline-none w-full max-w-xs"
      >
        <svg class="w-4 h-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
          <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/>
        </svg>
        Filters
        @if (search || status !== 'all' || startDate || endDate) {
          <span class="inline-flex items-center justify-center w-5 h-5 text-xs font-medium text-blue-600 bg-blue-50 rounded-full">!</span>
        }
      </button>
    </div>
    <!-- Md and up: 2x2 grid of filter controls -->
    <div class="hidden md:block w-full">
      <div class="rounded-xl border border-slate-200 bg-white p-4 shadow-sm">
        <div class="grid grid-cols-2 gap-4">
          <div>
            <label class="block text-xs font-medium text-slate-500 mb-1">Search by title</label>
            <input
              type="search"
              placeholder="Search title or description..."
              [ngModel]="search"
              (ngModelChange)="onSearchChange($event)"
              class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            />
          </div>
          <div class="relative">
            <label class="block text-xs font-medium text-slate-500 mb-1">Status</label>
            <button
              type="button"
              (click)="toggleStatusDropdown()"
              class="inline-flex items-center justify-center gap-1.5 text-slate-700 bg-white border border-slate-300 hover:bg-slate-50 focus:ring-4 focus:ring-slate-200 font-medium rounded-lg text-sm px-4 py-2.5 focus:outline-none w-full min-w-[140px]"
            >
              {{ getStatusLabel() }}
              <svg class="w-4 h-4 ms-1 shrink-0" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"/>
              </svg>
            </button>
            @if (openStatusDropdown()) {
              <div class="absolute z-10 mt-1 w-full min-w-[140px] bg-white border border-slate-200 rounded-lg shadow-lg py-1 top-full left-0">
                @for (opt of statusOptions; track opt.value) {
                  <button
                    type="button"
                    (click)="selectStatus(opt.value)"
                    class="inline-flex items-center w-full px-3 py-2 text-sm text-slate-700 hover:bg-slate-100 rounded"
                  >
                    {{ opt.label }}
                  </button>
                }
              </div>
            }
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-500 mb-1">Start date (from)</label>
            <input
              type="date"
              [ngModel]="startDate"
              (ngModelChange)="onStartDateChange($event)"
              class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            />
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-500 mb-1">End date (by)</label>
            <input
              type="date"
              [ngModel]="endDate"
              (ngModelChange)="onEndDateChange($event)"
              class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            />
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Filters modal (small screens) -->
  @if (filtersModalOpen()) {
    <div
      class="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 md:hidden"
      (click)="closeFiltersModal()"
    >
      <div
        class="bg-white rounded-xl shadow-xl border border-slate-200 w-full max-w-sm overflow-hidden"
        (click)="$event.stopPropagation()"
      >
        <div class="px-4 py-3 border-b border-slate-200 flex items-center justify-between">
          <h2 class="text-lg font-semibold text-slate-900">Filters</h2>
          <button type="button" (click)="closeFiltersModal()" class="p-2 text-slate-500 hover:bg-slate-100 rounded-lg">
            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6M6 6l12 12"/></svg>
          </button>
        </div>
        <div class="p-4 grid grid-cols-2 gap-4">
          <div class="col-span-2">
            <label class="block text-xs font-medium text-slate-500 mb-1">Search by title</label>
            <input
              type="search"
              placeholder="Search..."
              [ngModel]="search"
              (ngModelChange)="search = $event"
              class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500"
            />
          </div>
          <div class="col-span-2 relative">
            <label class="block text-xs font-medium text-slate-500 mb-1">Status</label>
            <button
              type="button"
              (click)="toggleStatusDropdown()"
              class="inline-flex items-center justify-center gap-1.5 text-slate-700 bg-white border border-slate-300 hover:bg-slate-50 font-medium rounded-lg text-sm px-4 py-2.5 w-full"
            >
              {{ getStatusLabel() }}
              <svg class="w-4 h-4 ms-1" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m19 9-7 7-7-7"/></svg>
            </button>
            @if (openStatusDropdown()) {
              <div class="absolute z-10 mt-1 w-full bg-white border border-slate-200 rounded-lg shadow-lg py-1">
                @for (opt of statusOptions; track opt.value) {
                  <button type="button" (click)="status = opt.value; openStatusDropdown.set(false)" class="inline-flex items-center w-full px-3 py-2 text-sm text-slate-700 hover:bg-slate-100 rounded">
                    {{ opt.label }}
                  </button>
                }
              </div>
            }
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-500 mb-1">Start date</label>
            <input type="date" [ngModel]="startDate" (ngModelChange)="startDate = $event" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500" />
          </div>
          <div>
            <label class="block text-xs font-medium text-slate-500 mb-1">End date</label>
            <input type="date" [ngModel]="endDate" (ngModelChange)="endDate = $event" class="w-full px-3 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500" />
          </div>
        </div>
        <div class="px-4 py-3 border-t border-slate-200 flex gap-2">
          <button type="button" (click)="closeFiltersModal()" class="flex-1 px-4 py-2 text-sm font-medium text-slate-700 bg-slate-100 rounded-lg hover:bg-slate-200">Cancel</button>
          <button type="button" (click)="applyFiltersAndCloseModal()" class="flex-1 px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded-lg hover:bg-blue-700">Apply</button>
        </div>
      </div>
    </div>
  }

  @if (error) {
    <div class="p-4 bg-red-50 border border-red-200 text-red-700 rounded-xl text-center">{{ error }}</div>
  } @else {
    <div class="rounded-xl border border-slate-200 bg-white shadow-sm overflow-hidden">
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-slate-200">
          <thead class="bg-slate-50">
            <tr>
              <th scope="col" class="px-4 sm:px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Title</th>
              <th scope="col" class="hidden md:table-cell px-4 sm:px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Status</th>
              <th scope="col" class="hidden lg:table-cell px-4 sm:px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Dates</th>
              <th scope="col" class="px-4 sm:px-6 py-3 text-right text-xs font-medium text-slate-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-slate-200">
            @if (loading) {
              @for (row of skeletonRowIndices; track row) {
                <tr class="animate-pulse">
                  <td class="px-4 sm:px-6 py-4"><div class="h-4 bg-slate-200 rounded w-48"></div></td>
                  <td class="hidden md:table-cell px-4 sm:px-6 py-4"><div class="h-5 bg-slate-200 rounded w-16"></div></td>
                  <td class="hidden lg:table-cell px-4 sm:px-6 py-4"><div class="h-4 bg-slate-100 rounded w-36"></div></td>
                  <td class="px-4 sm:px-6 py-4 text-right"><div class="h-8 bg-slate-200 rounded w-20 inline-block"></div></td>
                </tr>
              }
            } @else {
              @for (poll of polls; track poll.id) {
                <tr class="hover:bg-slate-50">
                  <td class="px-4 sm:px-6 py-4">
                    <a [routerLink]="['/admin/polls', poll.id, 'edit']" class="font-medium text-slate-900 hover:text-blue-600">
                      {{ poll.title }}
                    </a>
                  </td>
                  <td class="hidden md:table-cell px-4 sm:px-6 py-4">
                    <span
                      class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium"
                      [class.bg-green-100]="poll.isActive"
                      [class.text-green-800]="poll.isActive"
                      [class.bg-slate-100]="!poll.isActive"
                      [class.text-slate-800]="!poll.isActive"
                    >
                      {{ poll.isActive ? 'Active' : 'Inactive' }}
                    </span>
                  </td>
                  <td class="hidden lg:table-cell px-4 sm:px-6 py-4 text-sm text-slate-500">
                    {{ formatDate(poll.startsAt) }} – {{ formatDate(poll.endsAt) }}
                  </td>
                  <td class="px-4 sm:px-6 py-4 text-right space-x-2">
                    <a
                      [routerLink]="['/admin/polls', poll.id, 'results']"
                      class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-emerald-700 bg-emerald-50 rounded-lg hover:bg-emerald-100"
                      title="View results &amp; charts"
                    >
                      Results
                    </a>
                    <a
                      [routerLink]="['/polls', poll.id]"
                      class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-slate-700 bg-slate-100 rounded-lg hover:bg-slate-200"
                    >
                      View
                    </a>
                    <a
                      [routerLink]="['/admin/polls', poll.id, 'edit']"
                      class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-blue-700 bg-blue-50 rounded-lg hover:bg-blue-100"
                    >
                      Edit
                    </a>
                    <button
                      type="button"
                      (click)="deletePoll(poll.id, $event)"
                      [disabled]="deletingId === poll.id"
                      class="inline-flex items-center px-3 py-1.5 text-sm font-medium text-red-700 bg-red-50 rounded-lg hover:bg-red-100 disabled:opacity-50"
                    >
                      {{ deletingId === poll.id ? 'Deleting…' : 'Delete' }}
                    </button>
                  </td>
                </tr>
              }
              @empty {
                <tr>
                  <td colspan="4" class="px-4 sm:px-6 py-12 text-center text-slate-500">No polls yet. Create one to get started.</td>
                </tr>
              }
            }
          </tbody>
        </table>
      </div>
    </div>
  }
</div>
